<!DOCTYPE html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<head>
    <title>NKH Eligibility Navigator</title>
    <link href="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.13.0/dist/css/uswds.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.13.0/dist/js/uswds.min.js"></script>
</head>

<body style="padding: 1rem;">
    <header id="section_header" name="section_header" class="usa-header usa-header--basic" style="font-size: 1.5rem; font-weight: bold">
        Summer EBT Eligibility Navigator
    </header>

    <section id="section_content" name="section_content" class="usa-prose" style="max-width: 30rem;">
        <!-- SECTION CONTENT -->
    </section>

    <section id="navigation_area" name="navigation_area" class="usa-footer usa-footer--slim" style="padding-top:2rem; max-width: 30rem; display: flex; flex-direction: row">
        <!-- NAVIGATION BUTTONS -->
        <button class="usa-button" type="button" id="back_button" style="flex: 1">Back</button>
        <span style="flex: 1"></span>
        <button class="usa-button" type="button" id="next_button" style="flex: 1">Next</button>
    </section>
</body>

<script type="text/javascript">

// MODEL
// // get current and previous question codes
var current_question_code;
// var previous_question_code;

// store school ID
var school_navigator_id = null;

// store eligibility determination; intialize to false
var eligibility_determination = null;

// // create response dictionary
var user_responses = {};
var user_response_values = {};

var get_user_responses = function(event) {
    var question_code = event.target.name;
    var questions_answered = Object.keys(user_responses);
    if (questions_answered.includes(question_code)) {
        delete user_responses[question_code];
        delete user_response_values[question_code];
    };
    switch(question_code) {
        case "INS":
            // append "questions_answered" array
            // get household size
            var household_size = document.getElementById(question_code).value;
            user_responses[question_code] = household_size;
            user_response_values[question_code] = household_size;
            // write income question
            var household_income_question_stem = "Is your household income no more than ";
            var household_income_guidelines = [];
            income_guidelines.forEach((guideline) => {
                if ((guideline.household_size == household_size) && (guideline.fpl == 185) && (guideline.place == "(not AK or HI)")) {
                    household_income_guidelines.push(guideline);
                };
            });
            var annual_guideline_string, monthly_guideline_string, bimonthly_guideline_string, biweekly_guideline_string, weekly_guideline_string;
            var to_dollars = function(dollar_amount) {
                return dollar_amount.toLocaleString('en-US', {style: 'currency', currency: 'USD'})
            };
            household_income_guidelines.forEach((guideline) => {
                switch (guideline.income_frequency) {
                    case "annually":
                        annual_guideline_string = to_dollars(guideline.amount) + " annually";
                        break;
                    case "monthly":
                        monthly_guideline_string = to_dollars(guideline.amount) + " monthly";
                        break;
                    case "twice per month":
                        bimonthly_guideline_string = to_dollars(guideline.amount) + " twice per month";
                        break;
                    case "every two weeks":
                        biweekly_guideline_string = to_dollars(guideline.amount) + " every two weeks";
                        break;
                    case "weekly":
                        weekly_guideline_string = to_dollars(guideline.amount) + " weekly";
                        break;
                };
            });
            var household_income_guidelines_string = annual_guideline_string + ", " + monthly_guideline_string + ", " + bimonthly_guideline_string + ", " + biweekly_guideline_string + ", or " + weekly_guideline_string + "?";
            question_bank["INC"].question_text = household_income_question_stem + household_income_guidelines_string;
            break;
        case "SCH":
            // get school combo box value
            var school_combo_box = document.getElementById("SCH");
            var school_combo_box_code = school_combo_box.value;
            school_navigator_id = school_combo_box.id;
            console.log("school navigator ID: " + school_navigator_id);
            var school_combo_box_status_codes = ["nslp", "cep", "not_nslp"];
            // get non-school response options
            var non_school_response_options = document.querySelectorAll('input[name=' + question_code + ']');
            var non_school_response = [];
            non_school_response_options.forEach((option) => {
                if (option.checked == true) {
                    non_school_response.push(option.id);
                };
            });
            switch (event.type) {
                case "change":
                    user_responses["SCH"] = school_combo_box_code;
                    switch (school_combo_box_code) {
                        case "nslp":
                            user_response_values["SCH"] = 1;
                            break;
                        case "cep":
                            user_response_values["SCH"] = 2;
                            break;
                        case "not_nslp":
                            user_response_values["SCH"] = 0;
                            break;

                    }
                    non_school_response_options.forEach((option) => {
                        option.checked = false;
                        option.disabled = false;
                    });
                    break;
                case "click":
                    var selected_non_school_response = event.target.id;
                    var selected_non_school_response_value = event.target.value;
                    school_combo_box.value = "";
                    delete user_responses["SCH"];
                    user_responses["SCH"] = selected_non_school_response;
                    user_response_values["SCH"] = selected_non_school_response_value;
                    break;
            };
            break;
        default:
            // collect answer codes
            var selected_responses = document.querySelectorAll('input[name=' + question_code + ']:checked');
            var selected_response_codes = [];
            selected_responses.forEach((response) => {
                selected_response_codes.push(response.id);
            });
            user_responses[question_code] = selected_response_codes;
            // collect answer values
            var selected_response_values = [];
            selected_responses.forEach((response) => {
                selected_response_values.push(response.value);
            });
            user_response_values[question_code] = selected_response_values;
            evaluate_streamlined_cert_responses();
            // for streamlined cert questions, disable non-program/status answers when program/status answer is selected and vice versa
            var streamlined_cert_questions = ["SCP", "SCS"];
            if (streamlined_cert_questions.includes(question_code)){
                var response_options = document.querySelectorAll("input[name=" + question_code + "]");
                switch (true) {
                    case selected_response_values.length == 0:
                        response_options.forEach((option) =>{
                            option.disabled = false;
                        });
                        break;
                    case selected_response_values.includes("0"):
                        response_options.forEach((option) => {
                            switch (option.value) {
                                case "0":
                                    option.disabled = false;
                                    break;
                                default:
                                    option.disabled = true;
                                    break;
                            };
                        });
                        break;
                    case !selected_response_values.includes("0"):
                        response_options.forEach((option) => {
                            switch (option.value) {
                                case "0":
                                    option.disabled = true;
                                    break;
                                default:
                                    option.disabled = false;
                                    break;
                            };
                        });
                        break;
                };
            };
            break;
    };
    console.log(user_responses);
    console.log(user_response_values);
};

// // create Question class
class Question {
    constructor(language_code, question_code, question_text, question_hint, answer_input_type, answer_text, answer_codes, answer_values) {
        this.language_code = language_code;
        this.question_code = question_code;
        this.question_text = question_text;
        this.question_hint = question_hint;
        this.answer_input_type = answer_input_type;
        this.answer_text = answer_text;
        this.answer_codes = answer_codes;
        this.answer_values = answer_values;
    };
    create_question_fragment() {
        var question_fragment = new DocumentFragment();
        var question_text = Object.assign(document.createElement("legend"), {
            // id: this.question_code + "_text",
            className: "usa-legend",
            textContent: this.question_text
        });
        var question_hint = Object.assign(document.createElement("p"), {
            id: this.question_code + "_hint",
            className: "question_hint",
            textContent: this.question_hint
        });
        question_fragment.append(question_text);
        question_fragment.append(question_hint);
        return question_fragment;
    };
    create_answer_fragment() {
        var answer_fragment = new DocumentFragment();
        var answer_fragment_fieldset = Object.assign(document.createElement("fieldset"), {
            className: "usa-fieldset"
        });
        switch (true) {
            case this.question_code == "INS":
                // set up household size question
                var household_size_input = Object.assign(document.createElement("input"), {
                    type: "number",
                    className: "usa-input",
                    id: this.question_code,
                    name: this.question_code,
                    placeholder: "numbers only"
                });
                answer_fragment.append(answer_fragment_fieldset);
                answer_fragment_fieldset.appendChild(household_size_input);
                household_size_input.addEventListener("input", get_user_responses);
                break;
            case this.question_code == "SCH":
                // set up school input
                var school_combo_box_div = Object.assign(document.createElement("div"), {
                    className: "usa-combo-box"
                });
                var school_combo_box = Object.assign(document.createElement("select"), {
                    className: "usa-select",
                    id: this.question_code,
                    name: this.question_code
                })
                var school_combo_box_blank_option = Object.assign(document.createElement("option"), {
                    value: "",
                    textContent: "Select a school from this list"
                });
                school_combo_box.appendChild(school_combo_box_blank_option);
                schools.forEach((school) => {
                    var school_combo_box_option = Object.assign(document.createElement("option"), {
                        value: school.code,
                        textContent: "[" + school.district + "] " + school.school
                    });
                    school_combo_box_option.setAttribute("data-navigator_id", school.navigator_id);
                    school_combo_box.appendChild(school_combo_box_option);
                });
                answer_fragment.append(answer_fragment_fieldset);
                answer_fragment_fieldset.appendChild(school_combo_box_div);
                school_combo_box_div.appendChild(school_combo_box);
                school_combo_box.addEventListener("change", get_user_responses);
                // no break, to add "not in list" and homeschool options via default case
            default:
                // applies to all other questions
                answer_fragment.append(answer_fragment_fieldset);
                for (let i = 0; i < this.answer_text.length; i++) {
                    var answer_div = Object.assign(document.createElement("div"), {
                        className: "usa-" + this.answer_input_type
                    });
                    var answer_input = Object.assign(document.createElement("input"), {
                        type: this.answer_input_type,
                        className: "usa-" + this.answer_input_type + "__input",
                        id: this.answer_codes[i],
                        name: this.question_code,
                        value: this.answer_values[i]
                    });
                    var answer_input_label = Object.assign(document.createElement("label"), {
                        className: "usa-" + this.answer_input_type + "__label",
                        // for: this.answer_codes[i],
                        textContent: this.answer_text[i]
                    });
                    answer_input_label.setAttribute("for", this.answer_codes[i]);
                    // var get_user_responses = function(event) {
                    //     var question_code = event.target.name;
                    //     var selected_responses = document.querySelectorAll('input[name=' + question_code + ']:checked');
                    //     var selected_response_codes = [];
                    //     selected_responses.forEach((response) => {
                    //         selected_response_codes.push(response.id);
                    //     });
                    //     user_responses[question_code] = selected_response_codes;
                    //     console.log(user_responses);
                    // };
                    var line_break = document.createElement("br");
                    answer_fragment_fieldset.appendChild(answer_div);
                    answer_div.appendChild(answer_input);
                    answer_div.appendChild(answer_input_label);
                    answer_div.appendChild(line_break);
                    answer_input.addEventListener("click", get_user_responses)
                };
                if (this.question_code == "SCH") {
                    answer_input.addEventListener("click", get_user_responses);
                };
                break;
        }
        return answer_fragment;
    };
    display_question = function() {
        var question_area = document.getElementById("section_content");
        question_area.innerHTML = "";
        var this_question_fragment = this.create_question_fragment();
        var this_answer_fragment = this.create_answer_fragment();
        question_area.append(this_question_fragment);
        question_area.append(this_answer_fragment);
        current_question_code = this.question_code;
    };
};

// // questions
var questions = __QUESTIONS__;

var schools = __SCHOOLS__;
var schools_navigator_id_list = [];
schools.forEach((school) => {
    schools_navigator_id_list.push(school.navigator_id);
})

// // transform questions into question bank for display and input
var question_bank = {};
questions.forEach((question) => {
    question_bank[question.question_code] = new Question(question.language_code, question.question_code, question.question_text, question.question_hint, question.answer_input_type, question.answer_text, question.answer_codes, question.answer_values);
});

var income_guidelines = __INCOME_GUIDELINES__;

var outcomes = __OUTCOMES__;
var outcome_codes = [];
outcomes.forEach((outcome) => {
    outcome_codes.push(outcome.outcome_code);
});

// VIEW

var question_order = function() {
    let user_response_count = Object.keys(user_response_values).length;
    let next_question_code;
    let SCP = user_response_values["SCP"];
    let SCS = user_response_values["SCS"];
    let ACE = user_response_values["ACE"];
    let SCH = user_response_values["SCH"];
    let FRP = user_response_values["FRP"];
    let INS = user_response_values["INS"];
    let INC = user_response_values["INC"];
    console.log("response length: " + user_response_count);
    switch(true) {
        // for response counts using INC, add one for INS also
        // when to ask SCP -- first question; user_responses length of zero returns a falsy value, which returns a Boolean false
        case user_response_count == false:
            next_question_code = "SCP";
            break;
        // when to ask SCS
        case (user_response_count == 1 && SCP == 0):
        case (user_response_count == 2 && SCP == 2 && ACE == 1):
            next_question_code = "SCS"
            break;
        // when to ask ACE
        case (user_response_count == 2 && SCP == 0 && SCS == 1): 
        case (user_response_count == 1 && SCP == 1):
        case (user_response_count == 1 && SCP == 2):
            next_question_code = "ACE";
            break;
        // when to ask SCH
        case (user_response_count == 2 && SCP == 0 && SCS == 0):
        case (user_response_count == 3 && SCP == 0 && SCS == 1 && ACE == 0):
        case (user_response_count == 2 && SCP == 1 && ACE == 0):
        case (user_response_count == 2 && SCP == 2 && ACE == 0):
        case (user_response_count == 4 && SCP == 2 && ACE == 1 && SCS == 0 && INC == 0): 
            next_question_code = "SCH";
            break;
        // when to ask FRP
        case (user_response_count == 3 && SCP == 0 && SCS == 0 && SCH == 1):
        case (user_response_count == 4 && SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1):
        case (user_response_count == 3 && SCP == 1 && ACE == 0 && SCH == 1):
        case (user_response_count == 3 && SCP == 2 && ACE == 0 && SCH == 1):
        case (user_response_count == 5 && SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 1):
            next_question_code = "FRP";
            break;
        // when to ask INS
        case (user_response_count == 3 && SCP == 2 && SCS == 0):
        case (user_response_count == 3 && SCP == 0 && SCS == 0 && SCH == 2):
        case (user_response_count == 4 && SCP == 0 && SCS == 0 && SCH == 1 && (FRP == 0 || FRP ==2)):
        case (user_response_count == 5 && SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP ==2)):
        case (user_response_count == 4 && SCP == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP ==2)):
        case (user_response_count == 4 && SCP == 2 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2)):
        case (user_response_count == 6 && SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 1 && (FRP == 0 || FRP ==2)):
        case (user_response_count == 3 && SCP == 2 && ACE == 0 && SCH == 2):
            next_question_code = "INS";
            break;
        // when to ask INC
        case (user_response_count == 5 && SCP == 0 && SCS == 0 && SCH == 1 && (FRP == 0 || FRP ==2) && !FRP == []):
        case (user_response_count == 6 && SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP ==2) && !FRP == []):
        case (user_response_count == 5 && SCP == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP ==2) && !FRP == []):
        case (user_response_count == 5 && SCP == 2 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP ==2) && !FRP == []):
        case (user_response_count == 7 && SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 1 && (FRP == 0 || FRP ==2) && !FRP == []):
        case INS != undefined:
            next_question_code = "INC";
            break;
        // }
        // next_question(next_question_code);
    };
    question_bank[next_question_code].display_question();
    // current_question_code = next_question_code;
    console.log(user_responses);
};

var evaluate_streamlined_cert_responses = function() {
    // For streamlined certification questions where multiple responses are selected, assign the value that maximizes eligibility. For programs, streamlined certification via SNAP, TANF, FDPIR, and Head Start is preferable to having Medicaid because Medicaid requires confirmation of income eligibility while the other programs do not. For statuses, all statuses are equal.
    var responses_to_question;
    Object.keys(user_response_values).forEach((key) => {
        var responses_to_question = user_response_values[key];
        switch (key) {
            case "SCP":
                switch (true) {
                    case responses_to_question.includes("1"):
                        user_response_values[key] = "1";
                        break;
                    case responses_to_question.includes("2"):
                        user_response_values[key] = "2";
                        break;
                    case responses_to_question.includes("0"):
                        user_response_values[key] = "0";
                        break;
                };
                break;
            case "SCS":
                if (responses_to_question.includes("1")) {
                    user_response_values[key] = "1";
                } else if (responses_to_question.includes("0")) {
                    user_response_values[key] = "0";
                };
                break;
            default:
                break;
        };
    });
};

var determine_eligibility = function() {
    // let language = languageSelector.value;
    let user_response_count = Object.keys(user_response_values).length;
    // previous_question_code = current_question_code;
    let SCP = user_response_values["SCP"];
    let SCS = user_response_values["SCS"];
    let ACE = user_response_values["ACE"];
    let SCH = user_response_values["SCH"];
    let FRP = user_response_values["FRP"];
    let INS = user_response_values["INS"];
    let INC = user_response_values["INC"];
    console.log("response length: " + user_response_count);
    switch (true) {
        case (SCP == 1 && ACE == 1):
        case (SCP == 1 && ACE == 0 && SCH == 2):
        case (SCP == 2 && ACE == 1 && SCS == 0 && INC == 1):
            eligibility_determination = "mSCP";
            break;
        case (SCP == 0 && SCS == 1 && ACE == 1):
        case (SCP == 2 && ACE == 1 && SCS == 1):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 2):
            eligibility_determination = "mSCS";
            break;
        case (SCP == 0 && SCS == 0 && SCH == 1 && FRP == 1):
        case (SCP == 1 && ACE == 0 && SCH == 1 && FRP == 1):
        case (SCP == 2 && ACE == 0 && SCH == 1 && FRP == 1):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && FRP == 1):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && FRP == 1):
            eligibility_determination = "mFRP";
            break;
        case (SCP == 0 && SCS == 0 && SCH == 2 && INC == 1):
        case (SCP == 0 && SCS == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 1):
        case (SCP == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 1):
        case (SCP == 2 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 1):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 1):
        case (SCP == 2 && ACE == 0 && SCH == 2 && INC == 1):
        case (SCP == 2 && SCS == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 1):
            eligibility_determination = "mELI";
            break;
        case (INC == 2):
            eligibility_determination = "mUNK";
            break;
        case (SCP == 0 && SCS == 0 && SCH == 0):
        case (SCP == 1 && ACE == 0 && SCH == 0):
        case (SCP == 2 && ACE == 0 && SCH == 0):
        case (SCP == 0 && SCS == 0 && SCH == 2 && INC == 0):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 0):
        case (SCP == 2 && ACE == 0 && SCH == 2 && INC == 0):
        case (SCP == 0 && SCS == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 0):
        case (SCP == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 0):
        case (SCP == 2 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 0):
        case (SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 0):
        case (SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 2):
        case (SCP == 0 && SCS == 1 && ACE == 0 && SCH == 1 && (FRP == 0 || FRP == 2) && INC == 0):
        case (SCP == 2 && ACE == 1 && SCS == 0 && INC == 0 && SCH == 1 && (FRP == 0 || FRP == 2)):
            eligibility_determination = "mNOT";
            break;
        default:
            break;
    };
    display_eligibility_outcome();
};

var display_eligibility_outcome = function() {
    if (outcome_codes.includes(eligibility_determination)) {
        console.log(eligibility_determination);
        var eligibility_determination_element = document.getElementById("section_content");
        // eligibility_determination_element.className = "eligibility";
        // filter outcomes - filters to an array containing a single outcome dictionary --> use "[0]" to get the outcome as a dictionary only
        var determined_outcome = outcomes.filter(outcome => outcome.outcome_code == eligibility_determination)[0];
        switch (eligibility_determination) {
            case "mSCP":
                var template_outcome_text = determined_outcome.outcome_text;
                var outcome_text_to_modify = "{ programs selected from question }";
                var replacement_text = [];
                user_responses["SCP"].forEach((response) => {
                    var response_index = question_bank["SCP"].answer_codes.indexOf(response);
                    replacement_text.push(question_bank["SCP"].answer_text[response_index]);
                });
                var custom_outcome_text = template_outcome_text.replace(outcome_text_to_modify, replacement_text.join(", "));
                eligibility_determination_element.innerHTML = custom_outcome_text;
                break;
            case "mSCS":
                var template_outcome_text = determined_outcome.outcome_text;
                var outcome_text_to_modify = "{ statuses selected from question }";
                var replacement_text = [];
                user_responses["SCS"].forEach((response) => {
                    var response_index = question_bank["SCS"].answer_codes.indexOf(response);
                    replacement_text.push(question_bank["SCS"].answer_text[response_index]);
                });
                var custom_outcome_text = template_outcome_text.replace(outcome_text_to_modify, replacement_text.join(", "));
                eligibility_determination_element.innerHTML = custom_outcome_text;
                break;
            default:
                eligibility_determination_element.innerHTML = determined_outcome.outcome_text;
                break;
        };
        // next_button_element.value = button_text["reset"][language];
        // next_button_element.removeEventListener("click", determine_eligibility);
        // next_button_element.addEventListener("click", reset_navigator);
        // set_next_button();
        var next_button_element = document.getElementById("next_button");
        next_button_element.innerHTML = "Reset"
        next_button_element.removeEventListener("click", determine_eligibility)
        next_button_element.addEventListener("click", reset_navigator);
    } else {
        console.log("current question code: " + current_question_code);
        console.log(user_responses);
        question_order();
    };
}

var go_back = function() {
    // delete responses for current question if it has been answered
    switch (eligibility_determination == null) {
        case true:
            console.log("GO BACK");
            console.log("current question code: " + current_question_code);
            delete user_responses[current_question_code];
            console.log("user responses:");
            console.log(user_responses);
            delete user_response_values[current_question_code];
            console.log("user response values:");
            console.log(user_responses);
            // get list of questions already answered
        default:
            eligibility_determination = null;
            var questions_answered = Object.keys(user_responses);
            switch (questions_answered.length) {
                case 0:
                    // no questions answered yet, so show landing page text
                    break;
                default:
                    // show the previously answered question
                    var questions_answered = Object.keys(user_responses);
                    var previous_question_code = questions_answered[questions_answered.length - 1];
                    console.log("previous question code: " + previous_question_code);
                    question_bank[previous_question_code].display_question();
                    console.log("questions answered:");
                    console.log(questions_answered);
                    console.log(current_question_code);
                    //  fill in the answers to the previous question
                    var previous_answer_options = document.getElementsByName(previous_question_code);
                    console.log("answer IDs:");
                    previous_answer_options.forEach((option) => {
                        console.log(option.id);
                    });
                    previous_answer_options.forEach((option) => {
                        console.log("answer types:");
                    });
                    previous_answer_options.forEach((option) => {
                        console.log(option.tagName);
                    });
                    previous_answer_options.forEach((option) => {
                        switch(option.tagName) {
                            // get answer options by tag name to ensure user responses are properly populated - school input is a <select> tag, so correct <option> must be selected
                            case "SELECT":
                                if (!school_navigator_id == null) {
                                    var school_index = schools_navigator_id_list.indexOf(school_navigator_id);
                                    console.log("school index: " + school_index);
                                    var school_combo_box_element = document.getElementById("SCH");
                                    school_combo_box_element.selectedIndex = school_index;
                                };
                                break;
                            case "INPUT":
                                if (user_responses[previous_question_code].includes(option.id)) {
                                    option.checked = true;
                                }
                                break;
                        };
                    });
                    break;
            };
            var next_button = document.getElementById("next_button");
            next_button.innerHTML = "Next";
            next_button.removeEventListener("click", reset_navigator);
            next_button.addEventListener("click", determine_eligibility);
        break;
        };
};

var reset_navigator = function() {
    // remove user response info
    user_responses = {};
    user_response_values = {};
    school_navigator_id = null;
    eligibility_determination = null;
    // revert "next" button
    var next_button_element = document.getElementById("next_button");
    next_button_element.innerHTML = "Next"
    next_button_element.removeEventListener("click", reset_navigator)
    next_button_element.addEventListener("click", determine_eligibility);
    question_order();
};

// CONTROLLER

// change page title
document.title = "__TITLE__";

// set navigator header
document.getElementById("section_header").innerHTML = "__TITLE__";

// add event listeners to buttons
document.getElementById("back_button").addEventListener("click", go_back);
document.getElementById("next_button").addEventListener("click", determine_eligibility);

question_order();

</script>

